# GraphPrinter

![Plugin](https://user-images.githubusercontent.com/51815450/170719311-8dd70514-ef6b-4649-82bd-6be9232ae16e.PNG)

<!--ts-->
   * [概要](#概要)
      * [エディタ上での状態](#エディタ上での状態)
      * [出力された画像](#出力された画像)
      * [ノードの復元](#ノードの復元)
   * [動作環境](#動作環境)
   * [インストール](#インストール)
   * [使い方](#使い方)
      * [Stream Deck](#stream-deck)
   * [オプション](#オプション)
   * [備考](#備考)
   * [ライセンス](#ライセンス)
   * [作者](#作者)
   * [履歴](#履歴)
<!--te-->

## 概要

このプラグインはUnreal Engineのグラフエディタ(BlueprintやMaterialなど...)を画像ファイルに出力、またはクリップボードにコピーするショートカットキーを追加します。
また、下の画像の様にグラフエディタで表示していない部分も含めて画像ファイルに出力できます。
さらに出力した画像ファイルからノードを復元することもできます。  

#### エディタ上での状態  
![BeforeExport](https://user-images.githubusercontent.com/51815450/170719166-b02a5526-d052-404c-bb13-d888ad7c080f.PNG)

#### 出力された画像  
![BP_Sky_Sphere-RefreshMaterial](https://user-images.githubusercontent.com/51815450/170719253-f5365b35-e86c-4b1a-ac0a-7b3f425c050f.png)

#### ノードの復元  
https://user-images.githubusercontent.com/51815450/177288939-0ad344d9-fe39-4e44-bff7-1b7037793517.mp4

## 動作環境

対象バージョン : UE4.24 ～ 5.4  
対象プラットフォーム : Windows, Mac, Linux 

## インストール

プロジェクトのPluginsフォルダに[Plugins/GraphPrinter](https://github.com/Naotsun19B/GraphPrinter)フォルダを入れてください。  
または、[マーケットプレイス](https://www.unrealengine.com/marketplace/en/product/graph-printer)からインストールしてください。  
プラグインのインストール後に機能が使用できない場合は、プラグインが有効化されていない可能性がありますので、編集 > プラグイン からプラグインの有効のチェックが入っているかをご確認ください。  

## 使い方

追加される機能と対応するデフォルトのショートカットキーは以下の通りです。

| **ショートカットキー**　 | 　**機能**                                                  |
|:--------------:|----------------------------------------------------------|
|   Ctrl + F6    | 現在表示されている画面から、何れかのプリンターでサポートされているウィジェットを収集します。           |
|   Ctrl + F7    | 現在選択されているウィジェットの全体をクリップボードにコピーする。(**ノード情報の埋め込みは不可**)     |
|   Ctrl + F8    | 現在選択されているウィジェットの選択中の部分をクリップボードにコピーする。(**ノード情報の埋め込みは不可**) |
|   Ctrl + F9    | 現在選択されているウィジェットの全体を含む画像を出力します。                           |
|   Ctrl + F10   | 現在選択されているウィジェットの選択中の部分を含む画像を出力します。                       |
|   Ctrl + F11   | 現在選択されているウィジェットに選択した画像ファイルに含まれるウィジェットの状態を復元します。          |
|   Ctrl + F12   | エディタの環境設定で設定されている出力先のディレクトリを開きます。                        |

また、ショートカットキーはエディタの環境設定のキーボードショートカットから変更できます。

![KeyboardShortcuts](https://user-images.githubusercontent.com/51815450/170719363-f04a65c2-d08d-4cef-bc92-80d6703d450b.PNG)

ツールメニューやアセットエディタのツールバーから機能を呼び出すこともできます。  

![ToolMenu](https://user-images.githubusercontent.com/51815450/225569724-e150c60c-631a-4818-bf2a-9c831be2a157.png)
![Toolbar](https://user-images.githubusercontent.com/51815450/225569744-1befb4bc-12f5-464a-a125-1e5c13aa7967.png)

|       **カテゴリ**　        | 　**項目名**                                  | **機能**                                                         |
|:----------------------:|-------------------------------------------|----------------------------------------------------------------|
|         TARGET         | Collect Target Widgets                    | 現在表示されている画面から、何れかのプリンターでサポートされているウィジェットを収集します。                 |
|   COPY TO CLIPBOARD    | Copy All Area Of Widget To Clipboard      | 現在選択されているウィジェットの全体をクリップボードにコピーする。                              |
|                        | Copy Selected Area Of Widget To Clipboard | 現在選択されているウィジェットの選択中の部分をクリップボードにコピーする。                          |
|  EXPORT TO IMAGE FILE  | Print All Area Of Widget                  | 現在選択されているウィジェットの全体を含む画像を出力します。                                 |
|                        | Print Selected Area Of Widget             | 現在選択されているウィジェットの選択中の部分を含む画像を出力します。                             |
| IMPORT FROM IMAGE FILE | Restore Widget From Image File            | 現在選択されているウィジェットに選択した画像ファイルに含まれるウィジェットの状態を復元します。                |
|         OTHER          | Open Export Destination Folder            | エディタの環境設定で設定されている出力先のディレクトリを開きます。                              |
|                        | Open Plugin Settings                      | 各機能の設定画面を開きます。                                                 |
|                        | Install Stream Deck Plugin                | Stream Deck用のGraph PrinterプラグインをStream Deckアプリケーションにインストールします。 |

### Stream Deck

![StreamDeckApplication](https://user-images.githubusercontent.com/51815450/225564031-6e183445-9777-4c52-80f5-337c8f6e1ad8.PNG)

このプラグインはStream Deckからの機能の呼び出しに対応しています。  

機能を利用するには以下の手順に従ってください。  

1. ツールメニュー、またはツールバーの`Install Stream Deck Plugin`からStream Deck向けのGraph Printerプラグインをインストールします。  
2. Stream Deckアプリケーションで利用したい機能のボタンを配置します。  
3. 配置したボタンのプロパティの`Server URL`にサーバーURLを設定します。(デフォルトのままでも可)  
4. エディタ環境設定の`Graph Printer - Remote Control`の`Server URL`にStream Deck側と同じサーバーURLを設定します。(デフォルトのままでも可)  
5. エディタ環境設定の`Graph Printer - Remote Control`の`Enable Remote Control`を`true`にすることでStream Deckと接続できます。  
6. Stream Deckから配置したボタンを押下してください。  

## オプション

![EditorPreferences](https://user-images.githubusercontent.com/51815450/170719402-052f2f9e-91f3-41ab-9868-5e03bdfc4b31.PNG)

エディタの環境設定から設定できる項目は以下の通りです。

| **セクション**      　　      | **項目**                                   | **説明**                                                                                                  |
|------------------------|------------------------------------------|---------------------------------------------------------------------------------------------------------|
| Widget Printer         | Is Include Widget Info in Image File     | 出力する画像ファイルにウィジェットの情報を埋め込み、画像ファイルからウィジェットの状態を復元する機能を有効にします。　                                             |
|                        | Format                                   | 出力する画像の形式を設定します。対応している画像フォーマットは*png*、*jpeg*、*bmp*、*exr*です。                                              |
|                        | Compression Quality                      | 出力する画像の圧縮率を設定します。                                                                                       |
|                        | Filtering Mode                           | 出力する際に使用するテクスチャのフィルタリングモードを設定します。                                                                       |
|                        | Use Gamma                                | 出力する画像にガンマ値を反映するかを設定します。*false*の場合、出力された画像がエディタで見るよりも暗くなる場合があります。                                       |
|                        | Max Image Size                           | 出力画像の最大サイズを設定します。 このサイズを超えると出力できません。                                                                    |
|                        | Rendering Scale                          | グラフを描画するための縮尺が0.5の場合、半分の解像度で描画されます。Max Image Sizeよりも大きいグラフを描画する場合は値を小さくします。値を小さくすると描画結果に欠陥が生じる可能性があります。 |
|                        | Can Overwrite File when Export           | 画像を出力する際に同名のファイルを上書きするかを設定します。*false*の場合、同名のファイルがあった際にはサフィックスに連番が付きます。                                  |
|                        | Output Directory Path                    | 出力先のディレクトリを設定します。デフォルトでは"[Project]/Saved/GraphPrinter/"以下となっています。                                       |
| Generic Graph Printer  | Padding                                  | 画像に出力する際の余白を設定します。ノードが見切れる際などに値を大きくしてください。                                                              |
|                        | Draw Only Graph                          | グラフエディタのタイトルバーと右下のグラフタイプのテキストを非表示にするかどうかを設定します。                                                         |
| Material Graph Printer | Material Graph Export Method             | マテリアルグラフを出力する方法。プレビュービューポートを出力画像に結合したり、別々に出力したりできます。                                                    |
| Details Panel Printer  | Padding                                  | 詳細パネルを画像に出力する際の高さの余白を指定します。 出力画像が見切れる際などに値を大きくしてください。                                                   |
|                        | Is Include Expansion State In Image File | 各項目の展開状態を画像ファイルに埋め込む機能を有効にします。                                                                          |
|                        | Whether To Also Restore Expanded States  | 詳細パネルの画像から復元する時に各項目の展開状態も復元する機能を有効にします。                                                                 |
| Remote Control         | Enable Remote Control                    | Webソケット経由のリモートコントロールを有効にします。サーバーを起動しなおしたりした際には再度有効にしなおしてください。                                           |
|                        | ServerURL                                | サーバーのURLを設定します。ws、wss、またはwss+insecureを使用できます。                                                           |
| Editor Extension       | Show Sub Menu In Tool Menu               | エディターのツールメニューにプラグイン機能を実行するサブメニューを表示するかどうかを設定します。                                                        |
|                        | Show Combo Button In Toolbar             | アセットエディターのツールバーにプラグインの機能を実行するコンボボタンを表示するかどうかを設定します。                                                     |
|                        | Show Combo Button In StatusBar           | プラグインの機能を実行するコンボボタンをエディタのステータスバーに表示するかどうかを設定します。                                                        |
|                        | Collect Target Widgets Automatically     | 任意の種類のメニューを開いたときに、対象のウィジェットを自動的に収集するかどうか。                                                               |

## 備考

・クリップボードへコピーする際はウィジェットの情報を埋め込むことはできません。  
・詳細パネルに関する機能はUE5.0より前のエンジンバージョンとMacのプラットフォームでは利用できません。  
・Stream Deckに関する機能は現在Windowsプラットフォームでのみ利用可能です。  
・Stream DeckプラグインをインストールするメニューはStream Deckのアプリケーションがインストールされていない環境では表示されません。

## ライセンス

[MITライセンス](https://ja.wikipedia.org/wiki/MIT_License)

## 作者

[Naotsun](https://twitter.com/Naotsun_UE)

## 履歴

- (2024/04/24) v2.6   
  UE5.4に対応しました  
  クリップボードへコピーする機能をMacとLinuxでも動作するように対応しました  
  ステータスバーにもプラグインのメニューを追加しました  
  ツールメニュー、ツールバー、ステータスバーそれぞれにプラグインのメニューを表示するかどうかをエディタ環境設定から変更できるようにしました  

- (2023/09/07) v2.5
  UE5.3に対応しました  
  エディタ環境設定にあるプラグインの設定を全てのプロジェクト共通で保存されるようにしました

- (2023/05/17) v2.4  
  UE5.2に対応しました  

- (2023/03/16) v2.3  
  各機能に対してアイコンを設定しました  
  Webソケットを利用して外部からプラグインの機能を呼び出す機能を追加しました  
  詳細パネルのエクスポート/インポート機能を追加しました  
  Stream Deckから機能を呼び出せるようにしました  

- (2022/11/08) v2.2   
  UE5.1に対応しました  

- (2022/05/27) v2.1   
  ツールバーやツールメニューから機能を実行できるようにしました
  マテリアルグラフを出力する時にプレビュービューポートも一緒に出力する機能を追加しました  
  プラグインのモジュールやクラスを大幅に改善しました

- (2021/12/25) v2.0   
  グラフエディタのタイトルバーなどを非表示にできるオプションを追加しました

- (2021/11/28) v1.9   
  Linux環境でのUE4.27のコンパイルエラーを修正しました

- (2021/10/20) v1.8   
  UE5に対応しました  

- (2021/07/11) v1.7   
  グラフエディタの画像をクリップボードにコピーするショートカットキーを追加した(**Windows限定**)  

- (2021/05/28) v1.6   
  リファレンスビューワーを出力した時にファイル名にアセット名が含まれるように変更した  

- (2021/05/05) v1.5   
  エンジンを起動して初めて出力する画像が白みがかる不具合の対処を行った  

- (2021/04/15) v1.4   
  ノード情報を画像ファイルに埋め込み、画像ファイルからノードを復元する機能を追加  

- (2021/03/08) v1.3   
  ~~エンジンを起動して初めて出力する画像が白みがかる不具合の対処を行った~~

- (2021/01/21) v1.2   
  パッケージ化の際にエラーが発生する対策としてモジュールタイプをEditorNoCommandletに変更

- (2021/01/12) v1.1  
  巨大なグラフを出力する際にクラッシュするため、出力サイズに制限をかけられる機能を追加

- (2020/12/06) v1.0   
  プラグインを公開
